<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      content="initial-scale=1, shrink-to-fit=no, width=device-width"
      name="viewport"
    />
    <title>Test</title>
    <style type="text/css">
      div {
        width: 100vw;
        height: 100vh;
        display: table-cell;
        text-align: center;
        vertical-align: middle;
      }
      button {
        font-size: 2rem;
      }
      p {
        font-size: 2rem;
      }
      code {
        font-size: 1.5rem;
        word-break: break-all;
      }
    </style>
  </head>
  <body>
    <div align="center">
      <button>Test</button>
      <p align="center"></p>
    </div>

    <script type="text/javascript">
      const button = document.querySelector("button");
      button.addEventListener("click", onClick);

      function onClick(e) {
        e.preventDefault();
        const result = document.querySelector("p");
        const controller = new AbortController();
        const signal = controller.signal;
        const endpoint = "http://localhost:4000/invites/test";
        button.innerHTML = "Checking...";
        result.innerHTML = "...";
        fetch(endpoint, {
          mode: "cors",
          method: "POST",
          body: JSON.stringify({
            foo: "bar",
          }),
          headers: new Headers({
            "Content-Type": "application/json",
          }),
          signal: signal,
        })
          .then((res) => res.json())
          .then((data) => {
            if (data.msg) {
              button.innerHTML = "Test";
              result.innerHTML = data.msg;
              if (data.data) {
                result.innerHTML += `<br><br><code>${data.data}</code>`;
              }
            }
          })
          .catch((err) => {
            result.innerHTML = err;
          });
        setTimeout(() => {
          button.innerHTML = "Test";
        }, 3000);
      }
    </script>
  </body>
</html>
